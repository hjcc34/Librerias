#include "AHT20_CFG.h"

//------------------------------------------------------------------------------
//----------------------Inicializacion AHT20------------------------------------
//------------------------------------------------------------------------------
uint8_t ver_cal_AHT20(void)
{
    I2C_Start();
    I2C_Write_(AHT20_W);
    I2C_Write_(AHT20_R);
    I2C_Rstart();
    I2C_Write_(AHT20_R);
    I2C_RCEP();
    I2C_Lec_fin();
    I2C_Stop();
    return SSPBUF;
}
//------------------------------------------------------------------------------
//----------------------------CFG Medicion--------------------------------------
//------------------------------------------------------------------------------
void mes_AHT20(void)
{
    I2C_Start();
    I2C_Write_(AHT20_W);
    I2C_Write_(AHT20_Mes);
    I2C_Write_(AHT20_P3);
    I2C_Write_(AHT20_P2);
    I2C_Stop();   
}
//------------------------------------------------------------------------------
//--------------------------------Medicion--------------------------------------
//------------------------------------------------------------------------------
void med_AHT20(void)
{
    I2C_Start();
    I2C_Write_(AHT20_R);
    I2C_RCEP();
    b_0 = SSPBUF;
    I2C_Lec_seg();

    I2C_RCEP();
    b_1 = SSPBUF;
    I2C_Lec_seg();

    I2C_RCEP();
    b_2 = SSPBUF;
    I2C_Lec_seg();

    I2C_RCEP();
    b_3 = SSPBUF;
    I2C_Lec_seg();
    
    I2C_RCEP();
    b_4 = SSPBUF;
    I2C_Lec_seg();

    I2C_RCEP();
    b_5 = SSPBUF;
    I2C_Lec_fin();

    I2C_Stop();
}
//------------------------------------------------------------------------------
//----------------------------Calculo Humedad-----------------------------------
//------------------------------------------------------------------------------
void cal_AHT20(void)
{
    raw = ((uint32_t)byte_1 << 12) | ((uint32_t)byte_2 << 4) | (byte_3 >> 4);
    humedad = ((raw * 10000UL) / 1048576UL);
}
